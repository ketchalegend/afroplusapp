{"version":3,"file":"ionic-image-loader.js.map","sources":["ng://ionic-image-loader/lib/services/image-loader-config.service.ts","ng://ionic-image-loader/lib/services/image-loader.service.ts","ng://ionic-image-loader/lib/ionic-image-loader.component.ts","ng://ionic-image-loader/lib/ionic-image-loader.module.ts"],"sourcesContent":["import { HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ImageLoaderConfigService {\n  debugMode = false;\n\n  spinnerEnabled = true;\n\n  fallbackAsPlaceholder = false;\n\n  backgroundSize = 'contain';\n\n  backgroundRepeat = 'no-repeat';\n\n  display = 'block';\n\n  width = '100%';\n\n  height = '100%';\n\n  useImg = false;\n\n  fallbackUrl;\n\n  concurrency = 5;\n\n  maxCacheSize = -1;\n\n  maxCacheAge = -1;\n\n  imageReturnType: 'base64' | 'uri' = 'uri';\n\n  spinnerName;\n\n  spinnerColor;\n\n  httpHeaders: HttpHeaders;\n\n  // Must be default 'true' for the new WebView to show images\n  fileNameCachedWithExtension = true;\n\n  fallbackFileNameCachedExtension = '.jpg';\n\n  cacheDirectoryType: 'cache' | 'data' | 'external' = 'cache';\n\n  private _cacheDirectoryName = 'image-loader-cache';\n\n\n  get cacheDirectoryName() {\n    return this._cacheDirectoryName;\n  }\n\n  set cacheDirectoryName(name) {\n    name.replace(/\\W/g, '');\n    this._cacheDirectoryName = name;\n  }\n\n  /**\n   * Enables debug mode to receive console logs, errors, warnings\n   */\n  enableDebugMode() {\n    this.debugMode = true;\n  }\n\n  /**\n   * Enable/Disable the spinner by default. Defaults to true.\n   * @param enable set to true to enable\n   */\n  enableSpinner(enable: boolean) {\n    this.spinnerEnabled = enable;\n  }\n\n  /**\n   * Enable/Disable the fallback image as placeholder instead of the spinner. Defaults to false.\n   * @param enable set to true to enable\n   */\n  enableFallbackAsPlaceholder(enable: boolean) {\n    this.fallbackAsPlaceholder = enable;\n  }\n\n  /**\n   * Sets the cache directory name. Defaults to 'image-loader-cache'\n   * @param name name of directory\n   */\n  setCacheDirectoryName(name: string) {\n    this.cacheDirectoryName = name;\n  }\n\n  /**\n   * Set default height for images that are not using <img> tag\n   * @param height height\n   */\n  setHeight(height: string) {\n    this.height = height;\n  }\n\n  /**\n   * Set default width for images that are not using <img> tag\n   * @param width Width\n   */\n  setWidth(width: string) {\n    this.width = width;\n  }\n\n  /**\n   * Enable display mode for images that are not using <img> tag\n   * @param display Display mode\n   */\n  setDisplay(display: string) {\n    this.display = display;\n  }\n\n  /**\n   * Use <img> tag by default\n   * @param use set to true to use <img> tag by default\n   */\n  useImageTag(use: boolean) {\n    this.useImg = use;\n  }\n\n  /**\n   * Set default background size for images that are not using <img> tag\n   * @param backgroundSize Background size\n   */\n  setBackgroundSize(backgroundSize: string) {\n    this.backgroundSize = backgroundSize;\n  }\n\n  /**\n   * Set background repeat for images that are not using <img> tag\n   * @param backgroundRepeat Background repeat\n   */\n  setBackgroundRepeat(backgroundRepeat: string) {\n    this.backgroundRepeat = backgroundRepeat;\n  }\n\n  /**\n   * Set fallback URL to use when image src is undefined or did not resolve.\n   * This image will not be cached. This should ideally be a locally saved image.\n   * @param fallbackUrl The remote or local URL of the image\n   */\n  setFallbackUrl(fallbackUrl: string) {\n    this.fallbackUrl = fallbackUrl;\n  }\n\n  /**\n   * Set the maximum number of allowed connections at the same time.\n   * @param concurrency\n   */\n  setConcurrency(concurrency: number) {\n    this.concurrency = concurrency;\n  }\n\n  /**\n   * Sets the maximum allowed cache size\n   * @param cacheSize Cache size in bytes\n   */\n  setMaximumCacheSize(cacheSize: number) {\n    this.maxCacheSize = cacheSize;\n  }\n\n  /**\n   * Sets the maximum allowed cache age\n   * @param cacheAge Maximum cache age in milliseconds\n   */\n  setMaximumCacheAge(cacheAge: number) {\n    this.maxCacheAge = cacheAge;\n  }\n\n  /**\n   * Set the return type of cached images\n   * @param imageReturnType The return type; either 'base64' or 'uri'\n   */\n  setImageReturnType(imageReturnType: 'base64' | 'uri') {\n    this.imageReturnType = imageReturnType;\n  }\n\n  /**\n   * Set the default spinner name\n   * @param name\n   */\n  setSpinnerName(name: string) {\n    this.spinnerName = name;\n  }\n\n  /**\n   * Set the default spinner color\n   * @param color\n   */\n  setSpinnerColor(color: string) {\n    this.spinnerColor = color;\n  }\n\n  /**\n   * Set headers options for the HttpClient transfers.\n   * @param headers\n   */\n  setHttpHeaders(headers: HttpHeaders) {\n    this.httpHeaders = headers;\n  }\n\n  /**\n   * Set options for the FileTransfer plugin\n   * @param options\n   * @deprecated FileTransfer plugin removed.\n   */\n  setFileTransferOptions(options: {\n    trustAllHosts: boolean;\n    [key: string]: any;\n  }) {\n    // do nothing, plugin deprecated.\n  }\n\n  /**\n   * Enable/Disable the save filename of cached images with extension.  Defaults to false.\n   * @param enable set to true to enable\n   */\n  setFileNameCachedWithExtension(enable: boolean) {\n    this.fileNameCachedWithExtension = enable;\n  }\n\n  /**\n   * Set fallback extension filename of cached images.  Defaults to '.jpg'.\n   * @param extension fallback extension (e.x .jpg)\n   */\n  setFallbackFileNameCachedExtension(extension: string) {\n    this.fallbackFileNameCachedExtension = extension;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { File, FileEntry } from '@ionic-native/file/ngx';\nimport { WebView } from '@ionic-native/ionic-webview/ngx';\nimport { Platform } from '@ionic/angular';\nimport { fromEvent, Subject } from 'rxjs';\nimport { filter, first, take } from 'rxjs/operators';\nimport { ImageLoaderConfigService } from './image-loader-config.service';\n\ninterface IndexItem {\n  name: string;\n  modificationTime: Date;\n  size: number;\n}\n\ninterface QueueItem {\n  imageUrl: string;\n  resolve: Function;\n  reject: Function;\n}\n\ndeclare const Ionic: any;\n\nconst EXTENSIONS = ['jpg', 'png', 'jpeg', 'gif', 'svg', 'tiff'];\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ImageLoaderService {\n\n  /**\n   * Indicates if the cache service is ready.\n   * When the cache service isn't ready, images are loaded via browser instead.\n   */\n  private isCacheReady = false;\n  /**\n   * Indicates if this service is initialized.\n   * This service is initialized once all the setup is done.\n   */\n  private isInit = false;\n  private initPromiseResolve: Function;\n  private initPromise = new Promise<void>(resolve => this.initPromiseResolve = resolve);\n  private lockSubject = new Subject<boolean>();\n  private lock$ = this.lockSubject.asObservable();\n  /**\n   * Number of concurrent requests allowed\n   */\n  private concurrency = 5;\n  /**\n   * Queue items\n   */\n  private queue: QueueItem[] = [];\n  private processing = 0;\n  /**\n   * Fast accessible Object for currently processing items\n   */\n  private currentlyProcessing: { [index: string]: Promise<any> } = {};\n  private cacheIndex: IndexItem[] = [];\n  private currentCacheSize = 0;\n  private indexed = false;\n  private lockedCallsQueue: Function[] = [];\n\n  constructor(\n    private config: ImageLoaderConfigService,\n    private file: File,\n    private http: HttpClient,\n    private platform: Platform,\n    private webview: WebView,\n  ) {\n    if (!platform.is('cordova')) {\n      // we are running on a browser, or using livereload\n      // plugin will not function in this case\n      this.isInit = true;\n      this.throwWarning(\n        'You are running on a browser or using livereload, IonicImageLoader will not function, falling back to browser loading.',\n      );\n      this.initPromiseResolve();\n    } else {\n      fromEvent(document, 'deviceready')\n        .pipe(first())\n        .subscribe(res => {\n          if (this.nativeAvailable) {\n            this.initCache();\n          } else {\n            // we are running on a browser, or using livereload\n            // plugin will not function in this case\n            this.isInit = true;\n            this.initPromiseResolve();\n            this.throwWarning(\n              'You are running on a browser or using livereload, IonicImageLoader will not function, falling back to browser loading.',\n            );\n          }\n        });\n    }\n  }\n\n  get nativeAvailable(): boolean {\n    return File.installed();\n  }\n\n  private get isCacheSpaceExceeded(): boolean {\n    return (\n      this.config.maxCacheSize > -1 &&\n      this.currentCacheSize > this.config.maxCacheSize\n    );\n  }\n\n  private get isWKWebView(): boolean {\n    return (\n      this.platform.is('ios') &&\n      (<any>window).webkit &&\n      (<any>window).webkit.messageHandlers\n    );\n  }\n\n  private get isIonicWKWebView(): boolean {\n    return (\n      //  Important: isWKWebview && isIonicWKWebview must be mutually excluse.\n      //  Otherwise the logic for copying to tmp under IOS will fail.\n      (this.platform.is('android') && this.webview) ||\n      (this.platform.is('android')) && (location.host === 'localhost:8080') ||\n      (<any>window).LiveReload);\n  }\n\n  private get isDevServer(): boolean {\n    return window['IonicDevServer'] !== undefined;\n  }\n\n  /**\n   * Check if we can process more items in the queue\n   */\n  private get canProcess(): boolean {\n    return this.queue.length > 0 && this.processing < this.concurrency;\n  }\n\n  ready(): Promise<void> {\n    return this.initPromise;\n  }\n\n  /**\n   * Preload an image\n   * @param imageUrl Image URL\n   * @returns returns a promise that resolves with the cached image URL\n   */\n  preload(imageUrl: string): Promise<string> {\n    return this.getImagePath(imageUrl);\n  }\n\n  getFileCacheDirectory() {\n    if (this.config.cacheDirectoryType === 'data') {\n      return this.file.dataDirectory;\n    } else if (this.config.cacheDirectoryType === 'external') {\n      return this.platform.is('android') ? this.file.externalDataDirectory : this.file.documentsDirectory;\n    }\n    return this.file.cacheDirectory;\n  }\n\n  /**\n   * Clears cache of a single image\n   * @param imageUrl Image URL\n   */\n  async clearImageCache(imageUrl: string) {\n    if (!this.platform.is('cordova')) {\n      return;\n    }\n\n    await this.ready();\n\n    this.runLocked(async () => {\n      const fileName = this.createFileName(imageUrl);\n      const route = this.getFileCacheDirectory() + this.config.cacheDirectoryName;\n      // pause any operations\n      this.isInit = false;\n\n      try {\n        await this.file.removeFile(route, fileName);\n\n        if (this.isWKWebView && !this.isIonicWKWebView) {\n          await this.file.removeFile(this.file.tempDirectory + this.config.cacheDirectoryName, fileName);\n        }\n      } catch (err) {\n        this.throwError(err);\n      }\n\n      return this.initCache(true);\n    });\n  }\n\n  /**\n   * Clears the cache\n   */\n  async clearCache() {\n    if (!this.platform.is('cordova')) {\n      return;\n    }\n\n    await this.ready();\n\n    this.runLocked(async () => {\n      try {\n        await this.file.removeRecursively(this.getFileCacheDirectory(), this.config.cacheDirectoryName);\n\n        if (this.isWKWebView && !this.isIonicWKWebView) {\n          // also clear the temp files\n          try {\n            this.file.removeRecursively(this.file.tempDirectory, this.config.cacheDirectoryName);\n          } catch (err) {\n            // Noop catch. Removing the tempDirectory might fail,\n            // as it is not persistent.\n          }\n        }\n      } catch (err) {\n        this.throwError(err);\n      }\n\n      return this.initCache(true);\n    });\n  }\n\n  /**\n   * Gets the filesystem path of an image.\n   * This will return the remote path if anything goes wrong or if the cache service isn't ready yet.\n   * @param imageUrl The remote URL of the image\n   * @returns Returns a promise that will always resolve with an image URL\n   */\n  async getImagePath(imageUrl: string): Promise<string> {\n    if (typeof imageUrl !== 'string' || imageUrl.length <= 0) {\n      throw new Error('The image url provided was empty or invalid.');\n    }\n\n    await this.ready();\n\n    if (!this.isCacheReady) {\n      this.throwWarning('The cache system is not running. Images will be loaded by your browser instead.');\n      return imageUrl;\n    }\n\n    if (this.isImageUrlRelative(imageUrl)) {\n      return imageUrl;\n    }\n\n    try {\n      return await this.getCachedImagePath(imageUrl);\n    } catch (err) {\n      // image doesn't exist in cache, lets fetch it and save it\n      return this.addItemToQueue(imageUrl);\n    }\n  }\n\n  private async processLockedQueue() {\n    if (await this.getLockedState()) {\n      return;\n    }\n\n    if (this.lockedCallsQueue.length > 0) {\n      await this.setLockedState(true);\n\n      try {\n        await this.lockedCallsQueue.slice(0, 1)[0]();\n      } catch (err) {\n        console.log('Error running locked function: ', err);\n      }\n\n      await this.setLockedState(false);\n      return this.processLockedQueue();\n    }\n  }\n\n  private getLockedState(): Promise<boolean> {\n    return this.lock$\n      .pipe(take(1))\n      .toPromise();\n  }\n\n  private awaitUnlocked(): Promise<boolean> {\n    return this.lock$\n      .pipe(\n        filter(locked => !!locked),\n        take(1),\n      )\n      .toPromise();\n  }\n\n  private async setLockedState(locked: boolean) {\n    this.lockSubject.next(locked);\n  }\n\n  private runLocked(fn: Function) {\n    this.lockedCallsQueue.push(fn);\n    this.processLockedQueue();\n  }\n\n  /**\n   * Returns if an imageUrl is an relative path\n   * @param imageUrl\n   */\n  private isImageUrlRelative(imageUrl: string) {\n    return !/^(https?|file):\\/\\/\\/?/i.test(imageUrl);\n  }\n\n  /**\n   * Add an item to the queue\n   * @param imageUrl\n   * @param resolve\n   * @param reject\n   */\n  private addItemToQueue(imageUrl: string, resolve?, reject?): void | Promise<any> {\n    let p: void | Promise<any>;\n\n    if (!resolve && !reject) {\n      p = new Promise<any>((res, rej) => {\n        resolve = res;\n        reject = rej;\n      });\n    } else {\n      resolve = resolve || (() => {\n      });\n      reject = reject || (() => {\n      });\n    }\n\n    this.queue.push({\n      imageUrl,\n      resolve,\n      reject,\n    });\n\n    this.processQueue();\n\n    return p;\n  }\n\n  /**\n   * Processes one item from the queue\n   */\n  private async processQueue() {\n    // make sure we can process items first\n    if (!this.canProcess) {\n      return;\n    }\n\n    // increase the processing number\n    this.processing++;\n\n    // take the first item from queue\n    const currentItem: QueueItem = this.queue.splice(0, 1)[0];\n\n    // function to call when done processing this item\n    // this will reduce the processing number\n    // then will execute this function again to process any remaining items\n    const done = () => {\n      this.processing--;\n      this.processQueue();\n\n      // only delete if it's the last/unique occurrence in the queue\n      if (this.currentlyProcessing[currentItem.imageUrl] !== undefined && !this.currentlyInQueue(currentItem.imageUrl)) {\n        delete this.currentlyProcessing[currentItem.imageUrl];\n      }\n    };\n\n    const error = (e) => {\n      currentItem.reject();\n      this.throwError(e);\n      done();\n    };\n\n    if (this.currentlyProcessing[currentItem.imageUrl] !== undefined) {\n      try {\n        // Prevented same Image from loading at the same time\n        await this.currentlyProcessing[currentItem.imageUrl];\n        const localUrl = await this.getCachedImagePath(currentItem.imageUrl);\n        currentItem.resolve(localUrl);\n        done();\n      } catch (err) {\n        error(err);\n      }\n      return;\n    }\n\n    this.currentlyProcessing[currentItem.imageUrl] = (async () => {\n      // process more items concurrently if we can\n      if (this.canProcess) {\n        this.processQueue();\n      }\n\n      const localDir = this.getFileCacheDirectory() + this.config.cacheDirectoryName + '/';\n      const fileName = this.createFileName(currentItem.imageUrl);\n\n      try {\n        const data: Blob = await this.http.get(currentItem.imageUrl, {\n          responseType: 'blob',\n          headers: this.config.httpHeaders,\n        }).toPromise();\n\n        const file = await this.file.writeFile(localDir, fileName, data, {replace: true}) as FileEntry;\n\n        if (this.isCacheSpaceExceeded) {\n          this.maintainCacheSize();\n        }\n\n        await this.addFileToIndex(file);\n        const localUrl = await this.getCachedImagePath(currentItem.imageUrl);\n        currentItem.resolve(localUrl);\n        done();\n        this.maintainCacheSize();\n      } catch (err) {\n        error(err);\n        throw err;\n      }\n    })();\n\n  }\n\n  /**\n   * Search if the url is currently in the queue\n   * @param imageUrl Image url to search\n   */\n  private currentlyInQueue(imageUrl: string) {\n    return this.queue.some(item => item.imageUrl === imageUrl);\n  }\n\n  /**\n   * Initialize the cache service\n   * @param [replace] Whether to replace the cache directory if it already exists\n   */\n  private async initCache(replace?: boolean) {\n    this.concurrency = this.config.concurrency;\n\n    // create cache directories if they do not exist\n    try {\n      await this.createCacheDirectory(replace);\n      await this.indexCache();\n      this.isCacheReady = true;\n    } catch (err) {\n      this.throwError(err);\n    }\n\n    this.isInit = true;\n    this.initPromiseResolve();\n  }\n\n  /**\n   * Adds a file to index.\n   * Also deletes any files if they are older than the set maximum cache age.\n   * @param file FileEntry to index\n   */\n  private async addFileToIndex(file: FileEntry): Promise<any> {\n    const metadata = await new Promise<any>((resolve, reject) => file.getMetadata(resolve, reject));\n\n    if (\n      this.config.maxCacheAge > -1 &&\n      Date.now() - metadata.modificationTime.getTime() >\n      this.config.maxCacheAge\n    ) {\n      // file age exceeds maximum cache age\n      return this.removeFile(file.name);\n    } else {\n      // file age doesn't exceed maximum cache age, or maximum cache age isn't set\n      this.currentCacheSize += metadata.size;\n\n      // add item to index\n      this.cacheIndex.push({\n        name: file.name,\n        modificationTime: metadata.modificationTime,\n        size: metadata.size,\n      });\n    }\n  }\n\n  /**\n   * Indexes the cache if necessary\n   */\n  private async indexCache(): Promise<void> {\n    this.cacheIndex = [];\n\n    try {\n      const files = await this.file.listDir(this.getFileCacheDirectory(), this.config.cacheDirectoryName);\n      await Promise.all(files.map(this.addFileToIndex.bind(this)));\n      // Sort items by date. Most recent to oldest.\n      this.cacheIndex = this.cacheIndex.sort(\n        (a: IndexItem, b: IndexItem): number => (a > b ? -1 : a < b ? 1 : 0),\n      );\n      this.indexed = true;\n    } catch (err) {\n      this.throwError(err);\n    }\n  }\n\n  /**\n   * This method runs every time a new file is added.\n   * It checks the cache size and ensures that it doesn't exceed the maximum cache size set in the config.\n   * If the limit is reached, it will delete old images to create free space.\n   */\n  private async maintainCacheSize() {\n    if (this.config.maxCacheSize > -1 && this.indexed) {\n      const maintain = async () => {\n        if (this.currentCacheSize > this.config.maxCacheSize) {\n          // grab the first item in index since it's the oldest one\n          const file: IndexItem = this.cacheIndex.splice(0, 1)[0];\n\n          if (typeof file === 'undefined') {\n            return maintain();\n          }\n\n          // delete the file then process next file if necessary\n          try {\n            await this.removeFile(file.name);\n          } catch (err) {\n            // ignore errors, nothing we can do about it\n          }\n\n          this.currentCacheSize -= file.size;\n          return maintain();\n        }\n      };\n\n      return maintain();\n    }\n  }\n\n  /**\n   * Remove a file\n   * @param file The name of the file to remove\n   */\n  private async removeFile(file: string): Promise<any> {\n    await this.file.removeFile(this.getFileCacheDirectory() + this.config.cacheDirectoryName, file);\n\n    if (this.isWKWebView && !this.isIonicWKWebView) {\n      try {\n        return this.file.removeFile(this.file.tempDirectory + this.config.cacheDirectoryName, file);\n      } catch (err) {\n        // Noop catch. Removing the files from tempDirectory might fail, as it is not persistent.\n      }\n    }\n  }\n\n  /**\n   * Get the local path of a previously cached image if exists\n   * @param url The remote URL of the image\n   * @returns Returns a promise that resolves with the local path if exists, or rejects if doesn't exist\n   */\n  private async getCachedImagePath(url: string): Promise<string> {\n    await this.ready();\n\n    if (!this.isCacheReady) {\n      throw new Error('Cache is not ready');\n    }\n\n    // if we're running with livereload, ignore cache and call the resource from it's URL\n    if (this.isDevServer) {\n      return url;\n    }\n\n    // get file name\n    const fileName = this.createFileName(url);\n\n    // get full path\n    const dirPath = this.getFileCacheDirectory() + this.config.cacheDirectoryName,\n      tempDirPath = this.file.tempDirectory + this.config.cacheDirectoryName;\n\n    try {\n      // check if exists\n      const fileEntry = await this.file.resolveLocalFilesystemUrl(dirPath + '/' + fileName) as FileEntry;\n\n      // file exists in cache\n      if (this.config.imageReturnType === 'base64') {\n        // read the file as data url and return the base64 string.\n        // should always be successful as the existence of the file\n        // is already ensured\n        const base64: string = await this.file.readAsDataURL(dirPath, fileName);\n        return base64.replace('data:null', 'data:*/*');\n      } else if (this.config.imageReturnType !== 'uri') {\n        return;\n      }\n\n      // now check if iOS device & using WKWebView Engine.\n      // in this case only the tempDirectory is accessible,\n      // therefore the file needs to be copied into that directory first!\n      if (this.isIonicWKWebView) {\n        return this.normalizeUrl(fileEntry);\n      }\n\n      if (!this.isWKWebView) {\n        // return native path\n        return fileEntry.nativeURL;\n      }\n\n      // check if file already exists in temp directory\n      try {\n        const tempFileEntry = await this.file.resolveLocalFilesystemUrl(tempDirPath + '/' + fileName) as FileEntry;\n        // file exists in temp directory\n        // return native path\n        return this.normalizeUrl(tempFileEntry);\n      } catch (err) {\n        // file does not yet exist in the temp directory.\n        // copy it!\n        const tempFileEntry = await this.file\n          .copyFile(dirPath, fileName, tempDirPath, fileName) as FileEntry;\n\n        // now the file exists in the temp directory\n        // return native path\n        return this.normalizeUrl(tempFileEntry);\n      }\n    } catch (err) {\n      throw new Error('File does not exist');\n    }\n  }\n\n  /**\n   * Normalizes the image uri to a version that can be loaded in the webview\n   * @param fileEntry the FileEntry of the image file\n   * @returns the normalized Url\n   */\n\n  private normalizeUrl(fileEntry: FileEntry): string {\n    // Use Ionic normalizeUrl to generate the right URL for Ionic WKWebView\n    if (Ionic && typeof Ionic.normalizeURL === 'function') {\n      return Ionic.normalizeURL(fileEntry.nativeURL);\n    }\n    // use new webview function to do the trick\n    if (this.webview) {\n      return this.webview.convertFileSrc(fileEntry.nativeURL);\n    }\n    return fileEntry.nativeURL;\n  }\n\n  /**\n   * Throws a console error if debug mode is enabled\n   * @param args Error message\n   */\n  private throwError(...args: any[]) {\n    if (this.config.debugMode) {\n      args.unshift('ImageLoader Error: ');\n      console.error.apply(console, args);\n    }\n  }\n\n  /**\n   * Throws a console warning if debug mode is enabled\n   * @param args Error message\n   */\n  private throwWarning(...args: any[]) {\n    if (this.config.debugMode) {\n      args.unshift('ImageLoader Warning: ');\n      console.warn.apply(console, args);\n    }\n  }\n\n  /**\n   * Check if the cache directory exists\n   * @param directory The directory to check. Either this.file.tempDirectory or this.getFileCacheDirectory()\n   * @returns Returns a promise that resolves if exists, and rejects if it doesn't\n   */\n  private cacheDirectoryExists(directory: string): Promise<boolean> {\n    return this.file.checkDir(directory, this.config.cacheDirectoryName);\n  }\n\n  /**\n   * Create the cache directories\n   * @param replace override directory if exists\n   * @returns Returns a promise that resolves if the directories were created, and rejects on error\n   */\n  private createCacheDirectory(replace: boolean = false): Promise<any> {\n    let cacheDirectoryPromise: Promise<any>, tempDirectoryPromise: Promise<any>;\n\n    if (replace) {\n      // create or replace the cache directory\n      cacheDirectoryPromise = this.file.createDir(this.getFileCacheDirectory(), this.config.cacheDirectoryName, replace);\n    } else {\n      // check if the cache directory exists.\n      // if it does not exist create it!\n      cacheDirectoryPromise = this.cacheDirectoryExists(this.getFileCacheDirectory())\n        .catch(() => this.file.createDir(this.getFileCacheDirectory(), this.config.cacheDirectoryName, false));\n    }\n\n    if (this.isWKWebView && !this.isIonicWKWebView) {\n      if (replace) {\n        // create or replace the temp directory\n        tempDirectoryPromise = this.file.createDir(\n          this.file.tempDirectory,\n          this.config.cacheDirectoryName,\n          replace,\n        );\n      } else {\n        // check if the temp directory exists.\n        // if it does not exist create it!\n        tempDirectoryPromise = this.cacheDirectoryExists(\n          this.file.tempDirectory,\n        ).catch(() =>\n          this.file.createDir(\n            this.file.tempDirectory,\n            this.config.cacheDirectoryName,\n            false,\n          ),\n        );\n      }\n    } else {\n      tempDirectoryPromise = Promise.resolve();\n    }\n\n    return Promise.all([cacheDirectoryPromise, tempDirectoryPromise]);\n  }\n\n  /**\n   * Creates a unique file name out of the URL\n   * @param url URL of the file\n   * @returns Unique file name\n   */\n  private createFileName(url: string): string {\n    // hash the url to get a unique file name\n    return (\n      this.hashString(url).toString() +\n      (this.config.fileNameCachedWithExtension\n        ? this.getExtensionFromUrl(url)\n        : '')\n    );\n  }\n\n  /**\n   * Converts a string to a unique 32-bit int\n   * @param string string to hash\n   * @returns 32-bit int\n   */\n  private hashString(string: string): number {\n    let hash = 0,\n      char;\n    if (string.length === 0) {\n      return hash;\n    }\n    for (let i = 0; i < string.length; i++) {\n      char = string.charCodeAt(i);\n      // tslint:disable-next-line\n      hash = (hash << 5) - hash + char;\n      // tslint:disable-next-line\n      hash = hash & hash;\n    }\n    return hash;\n  }\n\n  /**\n   * Extract extension from filename or url\n   *\n   * @param url\n   * @returns\n   *\n   * Not always will url's contain a valid image extention. We'll check if any valid extention is supplied.\n   * If not, we will use the default.\n   */\n  private getExtensionFromUrl(url: string): string {\n    const urlWitoutParams = url.split(/\\#|\\?/)[0];\n    const ext: string = (urlWitoutParams.substr((~-urlWitoutParams.lastIndexOf('.') >>> 0) + 1) || '').toLowerCase();\n\n    return (\n      EXTENSIONS.indexOf(ext) >= 0 ? ext : this.config.fallbackFileNameCachedExtension\n    );\n  }\n}\n","import { Component, ElementRef, EventEmitter, Input, OnInit, Output, Renderer2 } from '@angular/core';\nimport { ImageLoaderConfigService } from './services/image-loader-config.service';\nimport { ImageLoaderService } from './services/image-loader.service';\n\nconst propMap: any = {\n  display: 'display',\n  height: 'height',\n  width: 'width',\n  backgroundSize: 'background-size',\n  backgroundRepeat: 'background-repeat',\n};\n\nexport interface ImageAttribute {\n  element: string;\n  value: string;\n}\n\n@Component({\n  selector: 'img-loader',\n  template: `\n    <ion-spinner\n        *ngIf=\"spinner && isLoading && !fallbackAsPlaceholder\"\n        [name]=\"spinnerName\"\n        [color]=\"spinnerColor\"\n    ></ion-spinner>\n    <ng-content></ng-content>\n  `,\n  styles: [\n    'ion-spinner { float: none; margin-left: auto; margin-right: auto; display: block; }',\n  ],\n})\nexport class IonicImageLoaderComponent implements OnInit {\n  /**\n   * Fallback URL to load when the image url fails to load or does not exist.\n   */\n  @Input() fallbackUrl: string = this.config.fallbackUrl;\n  /**\n   * Whether to show a spinner while the image loads\n   */\n  @Input() spinner: boolean = this.config.spinnerEnabled;\n  /**\n   * Whether to show the fallback image instead of a spinner while the image loads\n   */\n\n  @Input() fallbackAsPlaceholder: boolean = this.config.fallbackAsPlaceholder;\n  /**\n   * Attributes to pass through to img tag if _useImg == true\n   */\n  @Input() imgAttributes: ImageAttribute[] = [];\n  /**\n   * Enable/Disable caching\n   */\n  @Input() cache = true;\n  /**\n   * Width of the image. This will be ignored if using useImg.\n   */\n  @Input() width: string = this.config.width;\n  /**\n   * Height of the image. This will be ignored if using useImg.\n   */\n  @Input() height: string = this.config.height;\n  /**\n   * Display type of the image. This will be ignored if using useImg.\n   */\n  @Input() display: string = this.config.display;\n  /**\n   * Background size. This will be ignored if using useImg.\n   */\n  @Input() backgroundSize: string = this.config.backgroundSize;\n  /**\n   * Background repeat. This will be ignored if using useImg.\n   */\n  @Input() backgroundRepeat: string = this.config.backgroundRepeat;\n  /**\n   * Name of the spinner\n   */\n  @Input() spinnerName: string = this.config.spinnerName;\n  /**\n   * Color of the spinner\n   */\n  @Input() spinnerColor: string = this.config.spinnerColor;\n  /**\n   * Notify on image load..\n   */\n  @Output()\n  load: EventEmitter<IonicImageLoaderComponent> = new EventEmitter<IonicImageLoaderComponent>();\n  /**\n   * Indicates if the image is still loading\n   */\n  isLoading = true;\n  element: HTMLElement;\n\n  constructor(\n    private _element: ElementRef,\n    private renderer: Renderer2,\n    private imageLoader: ImageLoaderService,\n    private config: ImageLoaderConfigService,\n  ) {\n  }\n\n  private _useImg: boolean = this.config.useImg;\n\n  /**\n   * Use <img> tag\n   */\n  @Input()\n  set useImg(val: boolean) {\n    this._useImg = val !== false;\n  }\n\n  /**\n   * Convenience attribute to disable caching\n   */\n  @Input()\n  set noCache(val: boolean) {\n    this.cache = val !== false;\n  }\n\n  private _src: string;\n\n  get src(): string {\n    return this._src;\n  }\n\n  /**\n   * The URL of the image to load.\n   */\n  @Input()\n  set src(imageUrl: string) {\n    this._src = this.processImageUrl(imageUrl);\n    this.updateImage(this._src);\n  }\n\n  ngOnInit(): void {\n    if (this.fallbackAsPlaceholder && this.fallbackUrl) {\n      this.setImage(this.fallbackUrl, false);\n    }\n\n    if (!this.src) {\n      // image url was not passed\n      // this can happen when [src] is set to a variable that turned out to be undefined\n      // one example could be a list of users with their profile pictures\n      // in this case, it would be useful to use the fallback image instead\n      // if fallbackUrl was used as placeholder we do not need to set it again\n      if (!this.fallbackAsPlaceholder && this.fallbackUrl) {\n        // we're not going to cache the fallback image since it should be locally saved\n        this.setImage(this.fallbackUrl);\n      } else {\n        this.isLoading = false;\n      }\n    }\n  }\n\n  private updateImage(imageUrl: string) {\n    this.imageLoader\n      .getImagePath(imageUrl)\n      .then((url: string) => this.setImage(url))\n      .catch((error: any) => this.setImage(this.fallbackUrl || imageUrl));\n  }\n\n  /**\n   * Gets the image URL to be loaded and disables caching if necessary\n   */\n  private processImageUrl(imageUrl: string): string {\n    if (this.cache === false) {\n      // need to disable caching\n\n      if (imageUrl.indexOf('?') < 0) {\n        // add ? if doesn't exists\n        imageUrl += '?';\n      } else {\n        imageUrl += '&';\n      }\n      // append timestamp at the end to make URL unique\n      imageUrl += 'cache_buster=' + Date.now();\n    }\n\n    return imageUrl;\n  }\n\n  /**\n   * Set the image to be displayed\n   * @param imageUrl image src\n   * @param stopLoading set to true to mark the image as loaded\n   */\n  private setImage(imageUrl: string, stopLoading: boolean = true): void {\n    this.isLoading = !stopLoading;\n\n    if (this._useImg) {\n      // Using <img> tag\n      if (!this.element) {\n        // create img element if we dont have one\n        this.element = this.renderer.createElement('img');\n        this.renderer.appendChild(this._element.nativeElement, this.element);\n      }\n\n      // set it's src\n      this.renderer.setAttribute(this.element, 'src', imageUrl);\n\n      // if imgAttributes are defined, add them to our img element\n      this.imgAttributes.forEach((attribute) => {\n        this.renderer.setAttribute(this.element, attribute.element, attribute.value);\n      });\n      if (this.fallbackUrl && !this.imageLoader.nativeAvailable) {\n        this.renderer.listen(this.element, 'error', () =>\n          this.renderer.setAttribute(this.element, 'src', this.fallbackUrl),\n        );\n      }\n    } else {\n      // Not using <img> tag\n\n      this.element = this._element.nativeElement;\n\n      for (const prop in propMap) {\n        if (this[prop]) {\n          this.renderer.setStyle(this.element, propMap[prop], this[prop]);\n        }\n      }\n      this.renderer.setStyle(\n        this.element,\n        'background-image',\n        `url(\"${imageUrl || this.fallbackUrl}\")`,\n      );\n    }\n    if (stopLoading) {\n      this.load.emit(this);\n    }\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\nimport { File } from '@ionic-native/file/ngx';\nimport { IonicModule } from '@ionic/angular';\nimport { IonicImageLoaderComponent } from './ionic-image-loader.component';\n\nimport { ImageLoaderConfigService } from './services/image-loader-config.service';\nimport { ImageLoaderService } from './services/image-loader.service';\n\n@NgModule({\n  imports: [\n    IonicModule,\n    HttpClientModule,\n    CommonModule,\n  ],\n  declarations: [IonicImageLoaderComponent],\n  exports: [IonicImageLoaderComponent],\n})\nexport class IonicImageLoader {\n  static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: IonicImageLoader,\n      providers: [\n        ImageLoaderConfigService,\n        ImageLoaderService,\n        File,\n      ],\n    };\n  }\n}\n"],"names":[],"mappings":"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"}
